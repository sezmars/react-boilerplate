import{s as C,m as D,p as f,A as N,j as e,B as w,f as O,u as J,i as U,F as p,v as j,H as Y}from"./index-990f8a1f.js";import{R as W}from"./Row-60315f5f.js";import{F as _,I as v}from"./Input-c8e86fec.js";import{F as M}from"./FileInput-2b1ebf8d.js";import{u as ee}from"./index.esm-48454092.js";import{F as b}from"./FormRow-84b005e1.js";import{m as Q,d as ie,u as se}from"./useCabins-d1b28383.js";import{u as q}from"./useMutation-e0477c0c.js";import{j as re,k as te,g as ae}from"./index.esm-443ac182.js";import{M as l,C as ne,E as ce}from"./Empty-c363151f.js";import{T as S,M as h,a as oe,S as le}from"./TableOperations-d4ad2acd.js";import{F as de}from"./Filter-69aa9fc1.js";import"./iconBase-d64526d8.js";const ue=C.textarea`
  padding: 0.8rem 1.2rem;
  border: 1px solid var(--color-grey-300);
  border-radius: 5px;
  background-color: var(--color-grey-0);
  box-shadow: var(--shadow-sm);
  width: 100%;
  height: 8rem;
`,me=()=>{const a=D(),{mutate:i,isLoading:n}=q({mutationFn:({newCabinData:r,id:t})=>Q(r,t),onSuccess:async()=>{f.success("Cabin successfully edited"),await a.invalidateQueries({queryKey:[N.cabins]})},onError:r=>f.error(r)});return{isEditing:n,editCabin:i}},K=()=>{const a=D(),{mutate:i,isLoading:n}=q({mutationFn:Q,onSuccess:async()=>{f.success("New cabin successfully created"),await a.invalidateQueries({queryKey:["cabins"]})},onError:r=>f.error(r)});return{isCreating:n,createCabin:i}},z=({cabinToEdit:a={},onCloseModal:i})=>{var T,E,P,A,B,k,R,H,I,V;const{isCreating:n,createCabin:r}=K(),{isEditing:t,editCabin:d}=me(),c=n||t,{id:o,...u}=a,m=!!o,{register:s,handleSubmit:g,reset:F,getValues:Z,formState:$}=ee({defaultValues:m?u:{}}),{errors:y}=$,X=x=>{const L=typeof x.image=="string"?x.image:x.image[0];m?d({newCabinData:{...x,image:L},id:o},{onSuccess:()=>{F(),i==null||i()}}):r({...x,image:L},{onSuccess:()=>{F(),i==null||i()}})},G=()=>{};return e.jsxs(_,{onSubmit:g(X,G),type:i?"modal":"regular",children:[e.jsx(b,{label:"Cabine name",error:(E=(T=y.name)==null?void 0:T.message)==null?void 0:E.toString(),children:e.jsx(v,{type:"text",id:"name",disabled:c,...s("name",{required:"This field is requried"})})}),e.jsx(b,{label:"Maximum capacity",error:(A=(P=y.maxCapacity)==null?void 0:P.message)==null?void 0:A.toString(),children:e.jsx(v,{type:"number",id:"maxCapacity",disabled:c,...s("maxCapacity",{required:"This field is requried",min:{value:1,message:"Capacity should be at least 1"}})})}),e.jsx(b,{label:"Regular price",error:(k=(B=y.regularPrice)==null?void 0:B.message)==null?void 0:k.toString(),children:e.jsx(v,{type:"number",id:"regularPrice",disabled:c,...s("regularPrice",{required:"This field is requried",min:{value:1,message:"Capacity should be at least 1"}})})}),e.jsx(b,{label:"Discount",error:(H=(R=y.discount)==null?void 0:R.message)==null?void 0:H.toString(),children:e.jsx(v,{type:"number",id:"discount",disabled:c,defaultValue:0,...s("discount",{required:"This field is requried",validate:x=>+x<=+Z().regularPrice||"Discount should be less than regular price"})})}),e.jsx(b,{label:"Description for website",error:(V=(I=y.description)==null?void 0:I.message)==null?void 0:V.toString(),children:e.jsx(ue,{id:"description",disabled:c,defaultValue:"",...s("description",{required:"This field is requried"})})}),e.jsx(b,{label:"Cabin photo",children:e.jsx(M,{id:"image",accept:"image/*",...s("image",{required:o?!1:"This field is requried"})})}),e.jsxs(b,{children:[e.jsx(w,{variation:"secondary",type:"reset",onClick:()=>i==null?void 0:i(),children:"Cancel"}),e.jsx(w,{disabled:c,children:o?"Edit Cabin":"Create new cabin"})]})]})},xe=()=>{const a=D(),{isLoading:i,mutate:n}=q({mutationFn:ie,onSuccess:async()=>{f.success("Cabin successfully deleted"),await a.invalidateQueries({queryKey:[N.cabins]})},onError:r=>f.error(r)});return{isDeleting:i,deleteCabin:n}},be=C.img`
  display: block;
  width: 6.4rem;
  aspect-ratio: 3 / 2;
  object-fit: cover;
  object-position: center;
  margin-left: 10px;
  transform: scale(1.5) translateX(-7px);

  @media (max-width: 480px) {
    width: 2.4rem;
  }
`,he=C.div`
  font-size: 1.6rem;
  font-weight: 600;
  color: var(--color-grey-600);
  font-family: 'Sono';
`,pe=C.div`
  font-family: 'Sono';
  font-weight: 600;
`,je=C.div`
  font-family: 'Sono';
  font-weight: 500;
  color: var(--color-green-700);
`;function fe({cabin:a}){const{isDeleting:i,deleteCabin:n}=xe(),{createCabin:r}=K(),{id:t,name:d,maxCapacity:c,regularPrice:o,discount:u,image:m,description:s}=a,g=()=>{r({name:`Copy of ${d}`,maxCapacity:c,regularPrice:o,discount:u,image:m,description:s})};return e.jsxs(S.Row,{children:[e.jsx(be,{src:m,alt:d}),e.jsx(he,{children:d}),e.jsxs("div",{children:["First up to ",c," guest"]}),e.jsx(pe,{children:O(o)}),u?e.jsx(je,{children:O(u)}):e.jsx("span",{children:"â€”"}),e.jsx("div",{children:e.jsx(l,{children:e.jsxs(h.Menu,{children:[e.jsx(h.Toggle,{id:t}),e.jsxs(h.List,{id:t,children:[e.jsx(h.Button,{icon:e.jsx(re,{}),onClick:g,children:"Duplicate"}),e.jsx(l.Open,{opens:"edit",children:e.jsx(h.Button,{icon:e.jsx(te,{}),children:"Edit"})}),e.jsx(l.Open,{opens:"delete",children:e.jsx(h.Button,{icon:e.jsx(ae,{}),children:"Delete"})})]}),e.jsx(l.Window,{name:"edit",children:e.jsx(z,{cabinToEdit:a})}),e.jsx(l.Window,{name:"delete",children:e.jsx(ne,{resourceName:"cabins",disabled:i,onConfirm:()=>n(t)})})]})})})]})}const ge=()=>{const{isLoading:a,cabins:i}=se(),[n]=J();if(a)return e.jsx(U,{});if(!(i!=null&&i.length))return e.jsx(ce,{resourceName:"cabins"});const r=n.get("discount")||p.all;let t;r===p.all&&(t=i),r===p.noDiscount&&(t=i==null?void 0:i.filter(s=>s.discount===0)),r===p.withDiscount&&(t=i==null?void 0:i.filter(s=>s.discount>0));const d=n.get("sortBy")||"startDate-asc",[c,o]=d.split("-"),u=o==="asc"?1:-1,m=t==null?void 0:t.sort((s,g)=>(s[c]-g[c])*u);return e.jsx(h,{children:e.jsxs(S,{columns:"0.6fr 1.8fr 2.2fr 1fr 1fr 1fr",children:[e.jsxs(S.Header,{children:[e.jsx("div",{}),e.jsx("div",{children:"Cabin"}),e.jsx("div",{children:"Capacity"}),e.jsx("div",{children:"Price"}),e.jsx("div",{children:"Discount"}),e.jsx("div",{})]}),e.jsx(S.Body,{data:m,render:s=>e.jsx(fe,{cabin:s},s.id)})]})})},ye=()=>e.jsx("div",{children:e.jsxs(l,{children:[e.jsx(l.Open,{opens:"cabin-form",children:e.jsx(w,{children:"Add new cabin"})}),e.jsx(l.Window,{name:"cabin-form",children:e.jsx(z,{})})]})}),Ce=()=>e.jsxs(oe,{children:[e.jsx(de,{filterField:"discount",options:[{value:p.all,label:"All"},{value:p.noDiscount,label:"No discount"},{value:p.withDiscount,label:"With discount"}]}),"/",e.jsx(le,{options:[{value:j.nameAsc,label:"Sort by name (A-Z)"},{value:j.nameDesc,label:"Sort by name (Z-A)"},{value:j.regularPriceAsc,label:"Sort by price (low first)"},{value:j.regularPriceDesc,label:"Sort by price (high first)"},{value:j.maxCapacityAsc,label:"Sort by capacity (low first)"},{value:j.maxCapacityDesc,label:"Sort by capacity (high first)"}]})]}),He=()=>e.jsxs(e.Fragment,{children:[e.jsxs(W,{type:"horizontal",children:[e.jsx(Y,{as:"h1",children:"All cabins"}),e.jsx(Ce,{})]}),e.jsxs(W,{children:[e.jsx(ge,{}),e.jsx(ye,{})]})]});export{He as default};
